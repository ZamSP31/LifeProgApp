@{
    Layout = "~/Views/Shared/_MainLayout.cshtml";
}

<style>
    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: #f8f9fa;
        margin: 0;
        padding: 0;
    }

    .page-header {
        background: white;
        padding: 25px 30px;
        border-bottom: 2px solid #e0e0e0;
        margin-bottom: 25px;
    }

    .page-title {
        font-size: 24px;
        font-weight: 600;
        color: #2c3e50;
        margin: 0 0 8px 0;
    }

    .page-subtitle {
        font-size: 14px;
        color: #7f8c8d;
        margin: 0;
    }

    .action-bar {
        display: flex;
        gap: 12px;
        margin: 20px 0;
        flex-wrap: wrap;
    }

    .btn-action {
        padding: 10px 20px;
        border: none;
        border-radius: 5px;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s;
        display: inline-flex;
        align-items: center;
        gap: 8px;
    }

    .btn-primary-action {
        background: #3498db;
        color: white;
    }

        .btn-primary-action:hover {
            background: #2980b9;
        }

    .btn-secondary-action {
        background: white;
        color: #3498db;
        border: 1px solid #3498db;
    }

        .btn-secondary-action:hover {
            background: #ecf0f1;
        }

    .btn-warning-action {
        background: #e74c3c;
        color: white;
    }

        .btn-warning-action:hover {
            background: #c0392b;
        }

    .main-container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 0 30px 40px;
    }

    .stats-section {
        margin-bottom: 30px;
    }

    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }

    .stat-box {
        background: white;
        padding: 20px;
        border-radius: 6px;
        border: 1px solid #ddd;
    }

    .stat-title {
        font-size: 15px;
        color: #7f8c8d;
        margin-bottom: 15px;
        font-weight: 500;
    }

    .chart-wrapper {
        position: relative;
        height: 200px; /* Reduced from 250px */
        width: 200px; /* Fixed width */
        margin: 0 auto;
    }

        .chart-wrapper canvas {
            max-height: 200px !important; /* Force max size */
            max-width: 200px !important;
        }

    .stat-summary {
        margin-top: 15px;
        padding-top: 15px;
        border-top: 1px solid #ecf0f1;
    }

    .stat-item {
        display: flex;
        justify-content: space-between;
        margin-bottom: 8px;
        font-size: 13px;
    }

    .stat-label {
        color: #7f8c8d;
    }

    .stat-value {
        font-weight: 600;
        color: #2c3e50;
    }

    .status-dot {
        display: inline-block;
        width: 10px;
        height: 10px;
        border-radius: 50%;
        margin-right: 6px;
    }

    .status-active {
        background: #27ae60;
    }

    .status-archived {
        background: #e74c3c;
    }

    .data-table-section {
        background: white;
        border-radius: 6px;
        border: 1px solid #ddd;
        overflow: hidden;
    }

    .table-header {
        padding: 18px 20px;
        background: #f8f9fa;
        border-bottom: 2px solid #e0e0e0;
    }

    .table-title {
        font-size: 17px;
        font-weight: 600;
        color: #2c3e50;
        margin: 0;
    }

    .data-table {
        width: 100%;
        border-collapse: collapse;
    }

        .data-table thead tr {
            background: #fafafa;
        }

        .data-table th {
            padding: 12px 15px;
            text-align: left;
            font-size: 13px;
            font-weight: 600;
            color: #555;
            border-bottom: 2px solid #e0e0e0;
        }

        .data-table td {
            padding: 12px 15px;
            font-size: 13px;
            color: #333;
            border-bottom: 1px solid #f0f0f0;
        }

        .data-table tbody tr:hover {
            background: #f8f9fa;
        }

    .status-label {
        padding: 4px 12px;
        border-radius: 3px;
        font-size: 12px;
        font-weight: 500;
        display: inline-block;
    }

        .status-label.active {
            background: #d4edda;
            color: #155724;
        }

        .status-label.archived {
            background: #f8d7da;
            color: #721c24;
        }

    .action-btns {
        display: flex;
        gap: 5px;
    }

    .btn-table-action {
        padding: 5px 10px;
        border: 1px solid #ddd;
        background: white;
        border-radius: 3px;
        cursor: pointer;
        font-size: 12px;
        transition: all 0.2s;
    }

        .btn-table-action:hover {
            background: #f0f0f0;
        }

    .btn-edit {
        color: #3498db;
        border-color: #3498db;
    }

    .btn-delete {
        color: #e74c3c;
        border-color: #e74c3c;
    }

    .empty-message {
        text-align: center;
        padding: 40px;
        color: #999;
    }

        .empty-message i {
            font-size: 48px;
            color: #ddd;
            margin-bottom: 10px;
        }
</style>

<div ng-controller="LifeProgAppController" ng-init="loadUserStatusChart(); getDataFunc()" class="main-container">

    <!-- Page Header -->
    <div class="page-header">
        <h1 class="page-title">USER MANAGEMENT SYSTEM</h1>
        <p class="page-subtitle">Manage and monitor user accounts</p>

        <div class="action-bar">
            <button class="btn-action btn-primary-action" ng-click="redirectToRegistration()">
                <i class="material-icons" style="font-size: 18px;">person_add</i>
                Add New User
            </button>

            <button class="btn-action btn-secondary-action" ng-click="getDataFunc()">
                <i class="material-icons" style="font-size: 18px;">refresh</i>
                Reload Data
            </button>

            <button class="btn-action btn-warning-action" ng-click="downloadPDF()">
                <i class="material-icons" style="font-size: 18px;">picture_as_pdf</i>
                Export to PDF
            </button>
        </div>
    </div>

    <!-- Statistics Section -->
    <div class="stats-section">
        <div class="stats-grid">
            <!-- User Status Chart -->
            <div class="stat-box">
                <h3 class="stat-title">User Status Distribution</h3>
                <div class="chart-wrapper">


                    <canvas id="userStatusChart"
                            class="chart chart-pie"
                            chart-data="userStatusData"
                            chart-labels="userStatusLabels"
                            chart-colors="userStatusColors"
                            chart-options="chartOptions"
                            width="200"
                            height="200">        
                    </canvas>
                </div>
                <div class="stat-summary">
                    <div class="stat-item">
                        <span class="stat-label">
                            <span class="status-dot status-active"></span>Active Users
                        </span>
                        <span class="stat-value">{{userStatusData[0] || 0}}</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">
                            <span class="status-dot status-archived"></span>Archived Users
                        </span>
                        <span class="stat-value">{{userStatusData[1] || 0}}</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Total Users</span>
                        <span class="stat-value">{{(userStatusData[0] || 0) + (userStatusData[1] || 0)}}</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Data Table Section -->
    <div class="data-table-section">
        <div class="table-header">
            <h2 class="table-title">User Records</h2>
        </div>

        <table class="data-table">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>First Name</th>
                    <th>Last Name</th>
                    <th>Created</th>
                    <th>Last Updated</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                <tr ng-repeat="user in tableValue" ng-click="selectUser(user)">
                    <td>{{ user.registrationID }}</td>
                    <td>{{ user.firstName }}</td>
                    <td>{{ user.lastName }}</td>
                    <td>{{ user.createdAt | mvcDate | date:'MM/dd/yyyy h:mm a' }}</td>
                    <td>{{ user.updatedAt | mvcDate | date:'MM/dd/yyyy h:mm a' }}</td>
                    <td>
                        <span class="status-label" ng-class="user.isArchived == 0 ? 'active' : 'archived'">
                            {{ user.isArchived == 0 ? 'Active' : 'Archived' }}
                        </span>
                    </td>
                    <td>
                        <div class="action-btns">
                            <button class="btn-table-action btn-edit"
                                    ng-click="updateUser(user); $event.stopPropagation();"
                                    ng-if="user.isArchived == 0">
                                <i class="material-icons" style="font-size: 14px; vertical-align: middle;">edit</i>
                                Edit
                            </button>

                            <button class="btn-table-action btn-delete"
                                    ng-click="archiveUser(user.registrationID); $event.stopPropagation();">
                                <i class="material-icons" style="font-size: 14px; vertical-align: middle;">delete</i>
                                Archive
                            </button>
                        </div>
                    </td>
                </tr>
                <tr ng-if="!tableValue || tableValue.length == 0">
                    <td colspan="7">
                        <div class="empty-message">
                            <i class="material-icons">inbox</i>
                            <p>No users found. Click "Add New User" to create one.</p>
                        </div>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

<!-- Update Modal -->
<div id="updateModal" class="modal">
    <div class="modal-content">
        <h4>Update User Information</h4>
        <p style="color: #666; font-size: 14px;">Edit the user details below</p>

        <div class="row">
            <div class="input-field col s12">
                <i class="material-icons prefix">person</i>
                <input type="text" ng-model="selectedUser.firstName" id="editFirstName">
                <label for="editFirstName" class="active">First Name</label>
            </div>

            <div class="input-field col s12">
                <i class="material-icons prefix">person_outline</i>
                <input type="text" ng-model="selectedUser.lastName" id="editLastName">
                <label for="editLastName" class="active">Last Name</label>
            </div>
        </div>
    </div>

    <div class="modal-footer">
        <button class="btn grey waves-effect waves-light"
                onclick="M.Modal.getInstance(document.getElementById('updateModal')).close()">
            <i class="material-icons left">close</i>
            Cancel
        </button>
        <button class="btn blue waves-effect waves-light" ng-click="saveUpdate()">
            <i class="material-icons left">save</i>
            Save Changes
        </button>
    </div>
</div>

<!-- Initialize Materialize Components -->
<script>
    document.addEventListener('DOMContentLoaded', function () {
        var elems = document.querySelectorAll('.modal');
        M.Modal.init(elems);
    });
</script>